{{ define "load_paginator" }}

  {{ $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}
  {{ $noop := .Paginate $pages }}

{{ end }}

{{ define "load_page_assets" }}

  {{ range .Paginator.Pages }}
    {{ $noop := .Content }}
    {{ $page_css := .Scratch.Get "css" }}
    {{ with $page_css }}
      {{ $css_list := $.Scratch.Get "css" }}
      {{ merge $css_list . | $.Scratch.Set "css" }}
    {{ end }}
    {{ $page_js := .Scratch.Get "js" }}
    {{ with $page_js }}
      {{ $js_list := $.Scratch.Get "js" }}
      {{ merge $js_list . | $.Scratch.Set "js" }}
    {{ end }}
  {{ end }}

{{ end }}

{{ define "main" }}

  {{ if .Title }}
    {{ $context := dict "page" . "level" 1 "isdatehidden" true }}
    {{ partial "heading.html" $context }}
  {{ end }}

  {{ .Content }}

  {{ $length := len .Paginator.Pages }}
  {{ range $index, $page := .Paginator.Pages }}
    <article>
      {{ $context := dict "page" . "level" 2 }}
      {{ partial "heading.html" $context }}
      {{ with .Markup "home" }}
        {{ with .Render }}
          {{ if site.Params.summaries }}
            {{ .Summary }}
            {{ if $page.Truncated }}
              <p>
                <a class="u-clickable" href="{{ $page.RelPermalink }}">Read Moreâ€¦</a>
              </p>
            {{ end }}
          {{ else }}
            {{ .Content }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{ partial "tags.html" . }}
    </article>
    {{ if add $index 1 | ne $length | and site.Params.divider }}
      <div class="Divider"></div>
    {{ end }}
  {{ end }}

  {{ partial "pagination.html" . }}

{{ end }}
